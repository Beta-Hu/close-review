<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accepted Submission</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="main">
    <div class="head ui-sortable-helper">
        <div class="divlogo">
            <img src="img/logo.png" class="logo">
        </div>
        <div class="divbutton">
            <a class="profile" href="profile.html">Profile<br></a>
            <a class="sign" id="sign"></a>
        </div>
    </div>
    <div class="bigholder">
    </div>
    <div class="smallholder">
    </div>
    <div class="horizonalbox">
        <span class="bigfont" id="title"></span>
    </div>
    <div class="horizonalbox">
        <span class="bigfont" id="submission-id"></span>
        <button id="submit" type="submit" name="button" class="submitbutton" onclick="submit()">Submit</button>
    </div>
    <div>
        <ul>
            <li class="unsortedlist">
                <div class="smallholder"></div>
                <div class="horizonalbox">
                    <span class="accept-author" id="authors"></span>
                    <a class="smallhref">PDF</a>
                    <a class="smallhref">SupportMaterial</a>
                    <a class="smallhref">Rebuttal</a>
                </div>
                <div class="smallholder"></div>
                <span class="accept-abstract" id="abstracts"></span>
            </li>
        </ul>
    </div>
    <div class="bigholder"></div>
    <div>
        <ul class="list" id="reviewer">
        </ul>
    </div>
</div>
</body>

<p style="background: none; height: 5%; position: fixed; bottom: 0; width: 100%; text-align: center;">
    <img style="padding-top:2px; height: 10px; width: auto" src="/img/emblem.png" alt="">
    <a id="icp" class="icp" style="color:#000; font-size: 8px" href="https://beian.miit.gov.cn/" target="_blank"></a>
</p>

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/user-status.js"></script>
<script type="text/javascript" src="js/bei-an.js"></script>
<script type="text/javascript">
    window.onload = function () {
        var submissionId = window.location.href.split("=");
        submissionId = submissionId[submissionId.length - 1];
        $.ajax({
            type: "GET",
            url: "/submission/review/" + submissionId,
            dataType: 'json',
            async: true,
            data: {},
            success: function (data){
                var status = data["status"];
                var reviewerHead;
                var reviewerTail;

                document.getElementById("title").innerHTML = "# " + data["data"]["id"] + " " + data["data"]["title"];
                document.getElementById("abstracts").innerHTML = "Abstract: " + data["data"]["abstracts"];

                document.getElementById("title").setAttribute("readonly", "readonly");
                document.getElementById("authors").setAttribute("readonly", "readonly");
                document.getElementById("abstracts").setAttribute("readonly", "readonly");

                if (status === 0) {
                    for (var i = 0; i < data["data"]["comments"].length; i++){
                        reviewerHead = "<li>\n" +
                        "<span class=\"bigfont\"># Reviewer " + i + "</span>" +
                        "<ul class=\"list\">";

                        if (data["data"]["comments"][i]["initialComments"] == null)
                            break;

                        var commentsOfReviewer = ""
                        for (var j = 0; j < data["data"]["comments"][i]["initialComments"].length; j++){
                            commentsOfReviewer +=
                                "<li class='unsortedlist'>" +
                                "<input type='text' name='input' class='textsubmission' id='q" + j + "' " +
                                "value='" + data["data"]["comments"][i]["initialComments"][j] + "'>" +
                                "<div class='smallholder'></div></li>";
                        }

                        reviewerTail = "</ul></li></ul>";

                        document.getElementById("reviewer").innerHTML +=
                            reviewerHead + commentsOfReviewer + reviewerTail;
                    }
                }
            },
            error: function (){
                alert("load paper detail failed");
            }
        });
    };
</script>
<script>
    function submit () {
        var submissionId = parseInt(window.location.href.match(/submissionId=\d+/)[0].match(/\d+/)[0]);
        var data = [];
        for (var i = 0; ; i++){
            if (document.getElementById("q" + i) != null)
                data[data.length] = document.getElementById("q" + i).value;
            else
                break;
        }

        $.ajax({
            type: "POST",
            url: "/submission/review/" + submissionId,
            dataType: 'json',

            async: true,
            data: {
                "submissionId": submissionId,
                "initialComments": data,
                "initialScore": 0,
                "finalComments": "",
                "finalScore": 0
            },
            success: function (data) {
                if (data["status"] === 0)
                    alert("submit successfully");
                else
                    alert("submit failed");
            }
        });
    }
</script>

</html>
