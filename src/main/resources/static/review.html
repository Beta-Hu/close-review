<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accepted Submission</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="main">
    <div class="head ui-sortable-helper">
        <div class="divlogo">
            <img src="img/logo.png" class="logo" alt="">
        </div>
        <div class="divbutton">
            <a class="profile" href="profile.html">Profile<br></a>
            <a class="sign" id="sign"></a>
        </div>
    </div>
    <div class="bigholder">
    </div>
    <div class="smallholder">
    </div>
    <div class="horizonalbox">
        <span class="bigfont" id="title"></span>
    </div>
    <div class="horizonalbox">
        <span class="bigfont" id="submission-id"></span>
        <button id="submit" type="submit" name="button" class="submitbutton" onclick="submit()">Submit</button>
    </div>
    <div>
        <ul>
            <li class="unsortedlist">
                <div class="smallholder"></div>
                <div class="horizonalbox">
                    <span class="accept-author" id="authors"></span>
                    <a class="smallhref">PDF</a>
                    <a class="smallhref">SupportMaterial</a>
                    <a class="smallhref">Rebuttal</a>
                </div>
                <div class="smallholder"></div>
                <span class="accept-abstract" id="abstracts"></span>
            </li>
        </ul>
    </div>
    <div class="bigholder"></div>
    <div>
        <ul class="list" id="reviewer">
            <li>
                <div class='smallholder'></div>
                <label>Initial Comments: </label>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <input type='text' name='input' class='textsubmission' id='q0' value=''>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <input type='text' name='input' class='textsubmission' id='q1' value=''>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <input type='text' name='input' class='textsubmission' id='q2' value=''>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <input type='text' name='input' class='textsubmission' id='q3' value=''>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <input type='text' name='input' class='textsubmission' id='q4' value=''>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <label for='initialScore'>Initial Score: </label><select name='initialScore' class='scoreSelector' id='initialScore'>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                </select>
                <div class='smallholder'></div>
            </li>

            <li>
                <div class="bigholder"></div>
                <div class="smallholder"></div>
                <label>Final Comments:</label>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <input type='text' name='input' class='textsubmission' id='finalComments' value=''>
                <div class='smallholder'></div>
            </li>
            <li class='unsortedlist'>
                <label for='finalScore'>Final Score: </label><select name='finalScore' class='scoreSelector' id='finalScore'>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
                <div class='smallholder'></div>
            </li>
        </ul>
    </div>
</div>
</body>

<p style="background: none; height: 5%; position: fixed; bottom: 0; width: 100%; text-align: center;">
    <img style="padding-top:2px; height: 10px; width: auto" src="/img/emblem.png" alt="">
    <a id="icp" class="icp" style="color:#000; font-size: 8px" href="https://beian.miit.gov.cn/" target="_blank"></a>
</p>

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/user-status.js"></script>
<script type="text/javascript" src="js/bei-an.js"></script>
<script type="text/javascript">
    window.onload = function () {
        var submissionId = window.location.href.split("=");
        submissionId = submissionId[submissionId.length - 1];
        $.ajax({
            type: "GET",
            url: "/submission/review/" + submissionId,
            dataType: 'json',
            async: true,
            data: {},
            success: function (data){
                var status = data["status"];

                document.getElementById("title").innerHTML = "# " + data["data"]["id"] + " " + data["data"]["title"];
                document.getElementById("abstracts").innerHTML = "Abstract: " + data["data"]["abstracts"];

                document.getElementById("title").setAttribute("readonly", "readonly");
                document.getElementById("authors").setAttribute("readonly", "readonly");
                document.getElementById("abstracts").setAttribute("readonly", "readonly");

                if (status === 0) {
                    for (var i = 0; i < data["data"]["comments"].length; i++){

                        if (data["data"]["comments"][i]["initialComments"] != null)
                            for (var j = 0; j < data["data"]["comments"][i]["initialComments"].length; j++) {
                                document.getElementById("q" + j).setAttribute("value", data["data"]["comments"][i]["initialComments"][j]);
                                if (data["data"]["status"] !== 1)
                                    document.getElementById("q" + j).setAttribute("readonly", "readonly");
                            }

                        if (data["data"]["comments"][i]["initialScore"] != null) {
                            for (var j = 1; j <= 5; j++)
                                if (document.getElementById("initialScore")[j - 1].value === data["data"]["comments"][i]["initialScore"] + '')
                                    document.getElementById("initialScore")[j - 1].selected = true;
                            if (data["data"]["status"] !== 1)
                                document.getElementById("initialScore").setAttribute("disabled", "disabled");
                        }

                        if (data["data"]["comments"][i]["finalComments"] != null) {
                            document.getElementById("finalComments").setAttribute("value", data["data"]["comments"][i]["finalComments"]);
                            if (data["data"]["status"] !== 2)
                                document.getElementById("finalComments").setAttribute("readonly", "readonly");
                        }

                        if (data["data"]["comments"][i]["finalScore"] != null) {
                            for (var j = 1; j <= 5; j++)
                                if (document.getElementById("finalScore")[j - 1].value === data["data"]["comments"][i]["finalScore"] + '')
                                    document.getElementById("finalScore")[j - 1].selected = true;
                            if (data["data"]["status"] !== 2)
                                document.getElementById("finalScore").setAttribute("disabled", "disabled");
                        }
                    }
                }
            },
            error: function (){
                alert("load paper detail failed");
            }
        });
    };
</script>
<script>
    function submit () {
        var submissionId = parseInt(window.location.href.match(/submissionId=\d+/)[0].match(/\d+/)[0]);
        var data = [];
        for (var i = 0; ; i++){
            if (document.getElementById("q" + i) != null)
                data[data.length] = document.getElementById("q" + i).value;
            else
                break;
        }

        $.ajax({
            type: "POST",
            url: "/submission/review/" + submissionId,
            dataType: 'json',

            async: true,
            data: {
                "submissionId": submissionId,
                "initialComments": data,
                "initialScore": $("#initialScore option:selected").val(),
                "finalComments": "",
                "finalScore": $("#finalScore option:selected").val(),
            },
            success: function (data) {
                if (data["status"] === 0)
                    alert("submit successfully");
                else
                    alert("submit failed");
            }
        });
    }
</script>

</html>
